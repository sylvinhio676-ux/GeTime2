Token=39beca801973830b0792b35067e8da04

echo 'Looking to send emails in production? Check out our Email API/SMTP product!'
curl --location --request POST \
'https://sandbox.api.mailtrap.io/api/send/4288765' \
--header 'Authorization: Bearer <YOUR_API_TOKEN>' \
--header 'Content-Type: application/json' \
--data-raw '{"from":{"email":"hello@example.com","name":"Mailtrap Test"},"to":[{"email":"sylvinhio676@gmail.com"}],"subject":"You are awesome!","text":"Congrats for sending test email with Mailtrap!","category":"Integration Test"}'

1Ô∏è‚É£ Ouvrir un fichier (fopen)
FILE *f = fopen("data.txt", "r");

Modes principaux
Mode	Signification
"r"	lecture
"w"	√©criture (√©crase)
"a"	ajout
"r+"	lecture + √©criture
"w+"	√©criture + lecture

‚ö†Ô∏è Toujours v√©rifier :

if (f == NULL) {
    printf("Erreur ouverture fichier\n");
    return 1;
}

2Ô∏è‚É£ √âcrire dans un fichier
Avec fprintf
FILE *f = fopen("data.txt", "w");

fprintf(f, "Nom: Alice\n");
fprintf(f, "Age: 25\n");

fclose(f);


üëâ √âcrit dans le fichier au lieu de l‚Äô√©cran.

3Ô∏è‚É£ Lire depuis un fichier
Lire ligne par ligne (fgets)
char ligne[100];
FILE *f = fopen("data.txt", "r");

while (fgets(ligne, sizeof(ligne), f) != NULL) {
    printf("%s", ligne);
}

fclose(f);

Lire mot / nombre (fscanf)
int age;
char nom[20];

FILE *f = fopen("data.txt", "r");
fscanf(f, "%s %d", nom, &age);
fclose(f);

4Ô∏è‚É£ Copier un fichier (exemple complet)
#include <stdio.h>

int main() {
    FILE *src = fopen("source.txt", "r");
    FILE *dest = fopen("copie.txt", "w");

    if (!src || !dest) {
        printf("Erreur fichier\n");
        return 1;
    }

    char c;
    while ((c = fgetc(src)) != EOF) {
        fputc(c, dest);
    }

    fclose(src);
    fclose(dest);
    return 0;
}

5Ô∏è‚É£ Lire / √©crire caract√®re par caract√®re
Fonction	R√¥le
fgetc	lire un caract√®re
fputc	√©crire un caract√®re
6Ô∏è‚É£ Position dans le fichier
Se d√©placer (fseek)
fseek(f, 0, SEEK_SET); // d√©but
fseek(f, 0, SEEK_END); // fin

Position actuelle
long pos = ftell(f);

7Ô∏è‚É£ Supprimer / renommer un fichier
remove("data.txt");
rename("ancien.txt", "nouveau.txt");

8Ô∏è‚É£ Exemple r√©el : enregistrer des √©tudiants
#include <stdio.h>

typedef struct {
    char nom[20];
    int age;
} Etudiant;

int main() {
    FILE *f = fopen("etudiants.txt", "a");
    Etudiant e;

    printf("Nom: ");
    scanf("%s", e.nom);
    printf("Age: ");
    scanf("%d", &e.age);

    fprintf(f, "%s %d\n", e.nom, e.age);

    fclose(f);
    return 0;
}

üß† Sch√©ma mental
Programme C
   |
   |--> fopen()
   |--> fread / fwrite / fscanf / fprintf
   |--> fclose()

‚ö†Ô∏è Erreurs courantes

‚ùå Oublier fclose()
‚ùå Ne pas v√©rifier NULL
‚ùå Mauvais mode (r, w, a)

‚ú® R√©sum√© express

FILE * = fichier

fopen / fclose

fprintf / fscanf

fgets / fgetc

Toujours v√©rifier les erreurs

Voici une liste claire de fonctionnalit√©s pour rendre GeTime vraiment pro (prioris√©es et adapt√©es √† ton projet) :

Critiques (indispensables)

Audit log (qui a cr√©√©/modifi√©/supprim√© quoi)
Historique des versions du planning
Export PDF/Excel propres (emploi du temps par classe/enseignant/salle)
Gestion des conflits avanc√©e (suggestions de cr√©neaux alternatifs)
Permissions granulaires sur actions (create/update/delete par module)
Tr√®s utiles

Statuts de validation (brouillon ‚Üí valid√© ‚Üí publi√©)
Notifications cibl√©es (email + in‚Äëapp) selon r√¥le
Mode ‚Äúsimulation‚Äù avant publication
Disponibilit√©s automatiques (r√©cup√©ration par import)
Recherche globale (enseignants, mati√®res, salles, fili√®res)
Professionnel / premium

Tableau de bord analytique (taux d‚Äôoccupation, heures prof, charge)
Gestion multi‚Äëcampus/√©tablissements avec vues s√©par√©es
Moteur de g√©n√©ration automatique d‚Äôemplois du temps
Multi‚Äëlangue (FR/EN)
SSO / LDAP (pour universit√©s)
Qualit√© & fiabilit√©

Tests (unitaires + e2e)
Sauvegarde + restauration
Monitoring d‚Äôerreurs (Sentry)
Journal d‚Äôactivit√© pour chaque utilisateur
Si tu veux, je peux te proposer un plan concret par √©tapes (MVP ‚Üí pro ‚Üí premium) et te dire exactement quoi impl√©menter en premier.

oui


Voici un plan par √©tapes (MVP ‚Üí Pro ‚Üí Premium) adapt√© √† GeTime, avec actions concr√®tes.

√âtape 1 ‚Äî MVP Pro (1‚Äì2 semaines)

Audit log
Log des actions CRUD (planning, utilisateurs, mati√®res, salles)
Vue admin ‚ÄúHistorique‚Äù
Statut des plannings
Brouillon / Valid√© / Publi√©
Seuls les ‚Äúpubli√©s‚Äù visibles aux enseignants
Export propre
PDF par classe + par enseignant + par salle
Excel pour l‚Äôadministration
Notifications cibl√©es
Ex: cr√©ation/modif/suppression planning
In‚Äëapp + email
√âtape 2 ‚Äî Pro (2‚Äì4 semaines)

Conflits avanc√©s
Suggestions de cr√©neaux alternatifs
Indicateurs en temps r√©el dans le tableau
Workflow de validation
Programmeur propose ‚Üí Admin valide ‚Üí Publication
Historique des versions
Recherche globale
Recherche unique enseignants / mati√®res / salles
Dashboard analytique
Taux d‚Äôoccupation, heures prof, charge par fili√®re
√âtape 3 ‚Äî Premium (1‚Äì2 mois)

Auto‚Äëg√©n√©ration d‚Äôemploi du temps
Optimisation par contraintes
Multi‚Äëcampus & multi‚Äë√©tablissements avanc√©
Filtrage par campus / √©tablissement
SSO / LDAP
Connexion centralis√©e institutionnelle
Multi‚Äëlangue
FR/EN
√âv√©nements √† notifier

Cr√©ation de programmation
Modification
Suppression
Conflit d√©tect√©
Dis‚Äëmoi lesquels tu veux.
Canal

Dans l‚Äôapp seulement (notification interne)
Email en plus
Les deux
Qui re√ßoit

L‚Äôenseignant concern√©
Le programmeur
L‚Äôadmin
Tous les utilisateurs concern√©s (salle + enseignant + admin)
D√®s que tu me r√©ponds, je le mets en place et je t‚Äôexplique pas √† pas (fichiers + comment √ßa marche).

1, 2-les deux, 3-l'enseignant concerne-le programmeur-l'admin


J‚Äôai mis en place le syst√®me complet de notifications (backend + frontend) et je t‚Äôexplique clairement comment √ßa fonctionne.

Ce que j‚Äôai fait (r√©sum√© rapide)

Notifications DB + email via Laravel (table notifications, classe ProgrammationNotification).
Envoi automatique pour : cr√©ation, modification, suppression, conflit.
R√©ception par : enseignant concern√©, programmeur, admin/super_admin.
√âcran Notifications c√¥t√© frontend + routes API.
Fichiers backend (Laravel)

Table DB : 2026_01_06_000000_create_notifications_table.php
Classe notification : ProgrammationNotification.php
API notifications : NotificationController.php
Routes API : api.php
Envois ajout√©s dans : ProgrammationController.php
Fichiers frontend

Service API : notificationService.js
Page notifications : NotificationList.jsx
Route : AppRouter.jsx
Menu sidebar : Sidebar.jsx
Comment √ßa marche (simple)

Quand tu cr√©es/modifies/supprimes une programmation, le backend envoie une notification.
Si conflit, le backend envoie aussi une notification avec le message exact.
Les notifications sont enregistr√©es en base + envoy√©es par mail.
Chaque utilisateur voit ses notifications dans /dashboard/notifications.
√âtapes √† faire maintenant

Ex√©cuter la migration :
cd /home/sylvinhio/GeTime2/backend
php artisan migrate
Red√©marre Laravel.
Ouvre /dashboard/notifications pour voir les alertes.
Important (logique d‚Äôattribution)

Programmer : pris automatiquement depuis la sp√©cialit√© ou l‚Äôutilisateur connect√©.
Ann√©e acad√©mique : prise automatiquement via la date courante (date_star/date_end). proposer une roadmap par priorit√© (MVP ‚Üí Pro ‚Üí Enterprise) et chiffrer l‚Äôeffort estim√© pour chaque bloc.

oui


Voici une roadmap par priorite (MVP ‚Üí Pro ‚Üí Enterprise) avec effort estimatif.

MVP+ (1‚Äì2 semaines)

Auth + roles de base (admin/teacher/programmer) : 1‚Äì2 j
Filtrage par campus/annee/niveau : 1‚Äì2 j
Gestion des conflits planning (salle/enseignant) : 3‚Äì4 j
Export CSV/Excel des listes : 1‚Äì2 j
Notifications in‚Äëapp simples (toasts + historique) : 1‚Äì2 j
Pro (3‚Äì5 semaines)

Workflow validation programmation (draft ‚Üí valide ‚Üí publie) : 4‚Äì6 j
Rapports/Stats (occupation salles, charge enseignants) : 4‚Äì6 j
Journal d‚Äôaudit (who/when/what) : 3‚Äì5 j
Import Excel/CSV avec mapping : 4‚Äì6 j
Mode multi‚Äëcampus avance (espaces + permissions) : 4‚Äì6 j
Versioning simple des programmations : 3‚Äì5 j
Enterprise (6‚Äì10 semaines)

Notifications email/SMS (templates) : 5‚Äì8 j
2FA + securite (rate‚Äëlimit, policies) : 4‚Äì7 j
Internationalisation FR/EN : 3‚Äì5 j
Monitoring + alerting (logs, Sentry, uptime) : 4‚Äì6 j
CI/CD + tests e2e : 5‚Äì8 j
Sauvegarde/restore + plan de reprise : 4‚Äì6 j
Si tu veux, dis‚Äëmoi :

ta priorite (MVP/Pro/Enterprise)
ton delai
ton equipe (solo/2 pers/3+)
Et je te propose un plan detaille avec taches techniques et dependances.

============NOTIFICATION===============
Parfait. Avant d‚Äôimpl√©menter, j‚Äôai besoin de 3 pr√©cisions pour le syst√®me complet (backend + frontend) :

√âv√©nements √† notifier

Cr√©ation de programmation
Modification
Suppression
Conflit d√©tect√©
Dis‚Äëmoi lesquels tu veux.
Canal

Dans l‚Äôapp seulement (notification interne)
Email en plus
Les deux
Qui re√ßoit

L‚Äôenseignant concern√©
Le programmeur
L‚Äôadmin
Tous les utilisateurs concern√©s (salle + enseignant + admin)
D√®s que tu me r√©ponds, je le mets en place et je t‚Äôexplique pas √† pas (fichiers + comment √ßa marche).

1, 2-les deux, 3-l'enseignant concerne-le programmeur-l'admin


J‚Äôai mis en place le syst√®me complet de notifications (backend + frontend) et je t‚Äôexplique clairement comment √ßa fonctionne.

Ce que j‚Äôai fait (r√©sum√© rapide)

Notifications DB + email via Laravel (table notifications, classe ProgrammationNotification).
Envoi automatique pour : cr√©ation, modification, suppression, conflit.
R√©ception par : enseignant concern√©, programmeur, admin/super_admin.
√âcran Notifications c√¥t√© frontend + routes API.
Fichiers backend (Laravel)

Table DB : 2026_01_06_000000_create_notifications_table.php
Classe notification : ProgrammationNotification.php
API notifications : NotificationController.php
Routes API : api.php
Envois ajout√©s dans : ProgrammationController.php
Fichiers frontend

Service API : notificationService.js
Page notifications : NotificationList.jsx
Route : AppRouter.jsx
Menu sidebar : Sidebar.jsx
Comment √ßa marche (simple)

Quand tu cr√©es/modifies/supprimes une programmation, le backend envoie une notification.
Si conflit, le backend envoie aussi une notification avec le message exact.
Les notifications sont enregistr√©es en base + envoy√©es par mail.
Chaque utilisateur voit ses notifications dans /dashboard/notifications.
√âtapes √† faire maintenant

Ex√©cuter la migration :
cd /home/sylvinhio/GeTime2/backend
php artisan migrate
Red√©marre Laravel.
Ouvre /dashboard/notifications pour voir les alertes.
Important (logique d‚Äôattribution)

Programmer : pris automatiquement depuis la sp√©cialit√© ou l‚Äôutilisateur connect√©.
Ann√©e acad√©mique : prise automatiquement via la date courante (date_star/date_end).


=============UML===============
+-----------Class--------------+
@startuml
title Diagramme de classes d√©taill√© - GeTime
skinparam classAttributeIconSize 0

class Ecole {
  +nom_ecole
  +description
  +responsable_utilisateur_id
  --
  +secteurs(): Filiere[*]
  +responsable(): Utilisateur
}

class Filiere {
  +nom_filiere
  +code
  +ecole_id
  --
  +specialites(): Specialite[*]
  +ecole(): Ecole
}

class Niveau {
  +nom_niveau
  --
  +specialites(): Specialite[*]
}

class Specialite {
  +nom_specialite
  +code
  +description
  +nombre_etudiants
  +secteur_id
  +programmeur_id
  +niveau_id
  --
  +matieres(): Matiere[*]
  +secteur(): Filiere
  +niveau(): Niveau
  +programmeur(): Programmeur
  +programmations(): Programmation[*]
}

class Utilisateur {
  +nom
  +email
  +telephone
  +mot_de_passe
  --
  +enseignant(): Enseignant
  +programmeur(): Programmeur
  +casts(): tableau
}

class Enseignant {
  +matricule
  +utilisateur_id
  --
  +genererMatricule(): chaine
  +utilisateur(): Utilisateur
  +matieres(): Matiere[*]
}

class Programmeur {
  +matricule
  +utilisateur_id
  +etablissement_id
  --
  +genererMatricule(): chaine
  +utilisateur(): Utilisateur
  +programmations(): Programmation[*]
  +specialites(): Specialite[*]
  +etablissement(): Etablissement
}

class Etablissement {
  +nom_etablissement
  +description
  +ville
  --
  +programmeurs(): Programmeur[*]
  +campus(): Campus[*]
  +disponibilites(): Disponibilite[*]
}

class Campus {
  +nom_campus
  +localisation
  +etablissement_id
  --
  +salles(): Salle[*]
  +etablissement(): Etablissement
}

class Salle {
  +code
  +capacite
  +disponible
  +type_salle
  +campus_id
  --
  +programmations(): Programmation[*]
  +campus(): Campus
}

class Matiere {
  +nom_matiere
  +heures_par_semaine
  +heures_totales
  +type_matiere
  +couleur
  +enseignant_id
  +specialite_id
  --
  +enseignant(): Enseignant
  +disponibilites(): Disponibilite[*]
  +programmations(): Programmation[*]
  +specialite(): Specialite
}

class Annee {
  +date_debut
  +date_fin
  --
  +programmations(): Programmation[*]
}

class Programmation {
  +jour
  +heure_debut
  +heure_fin
  +matiere_id
  +programmeur_id
  +annee_id
  +salle_id
  --
  +matiere(): Matiere
  +salle(): Salle
  +annee(): Annee
  +programmeur(): Programmeur
  +specialites(): Specialite[*]
}

class Disponibilite {
  +jour
  +heure_debut
  +heure_fin
  +matiere_id
  +etablissement_id
  --
  +matiere(): Matiere
  +etablissement(): Etablissement
}

class EnseignantEtablissement{
  +enseignant_id
  +Etablissement_id
  --
  +enseignant() : Enseignant
  +etablissement() : Etablissement
}

' --- H√©ritage
Utilisateur <|-- Enseignant
Utilisateur <|-- Programmeur

' --- Relations principales
Ecole "1" -- "*" Filiere : regroupe
Filiere "1" -- "*" Specialite : possede
Niveau "1" -- "*" Specialite : regroupe
Specialite "1" -- "*" Matiere : comprend
Enseignant "1" -- "*" Matiere : dispense

Etablissement "1" -- "*" Programmeur : possede
Etablissement "1" -- "*" Campus : possede
Campus "1" -- "*" Salle : contient

Annee "1" -- "*" Programmation : concerne
Salle "1" -- "*" Programmation : concerne
Matiere "1" -- "*" Programmation : concerne
Programmeur "1" -- "*" Programmation : etabli

Matiere "1" -- "*" Disponibilite : peut avoir
Etablissement "1" -- "*" Disponibilite : possede

'---Relation ManyToMany
Enseignant "*" -- "*" Etablissement : EnseignantEtablissement
(Enseignant, Etablissement) .. EnseignantEtablissement

@enduml


+-------------sequence---------------+
|.............Disponibilite..........|
@startuml
title G√©rer disponibilit√©s personnelles
actor Enseignant
participant "Frontend" as FE
participant "API Disponibilit√©" as API
database "DB" as DB

Enseignant -> FE: Soumettre disponibilit√©
activate FE
FE -> API: POST/PUT /disponibilities
activate API
API -> DB: V√©rifier chevauchement
activate DB
DB --> API: Conflit ? oui/non
deactivate DB

alt Pas de conflit
  API -> DB: Enregistrer disponibilit√©
  activate DB
  DB --> API: OK
  deactivate DB
  API --> FE: 200 OK
  FE --> Enseignant: Confirmation
else Conflit d√©tect√©
  API --> FE: 409 Conflict
  FE --> Enseignant: Message d'erreur
end

deactivate API
deactivate FE
@enduml

|...............Auth.................|
@startuml
title Authentification
actor Utilisateur
participant "Frontend" as FE
participant "API Auth" as API
database "DB" as DB

Utilisateur -> FE: Saisir identifiants
activate FE
FE -> API: POST /login
activate API
API -> DB: Chercher utilisateur
activate DB
DB --> API: Utilisateur + hash
deactivate DB

API -> API: V√©rifier mot de passe
alt Valide
  API --> FE: Token + profil + r√¥les + permissions
  FE --> Utilisateur: Session ouverte
else Invalide
  API --> FE: 401 Unauthorized
  FE --> Utilisateur: Message d'erreur
end

deactivate API
deactivate FE
@enduml

|..............Programmation................|
@startuml
title G√©rer programmations (d√©taill√©)
actor Programmeur
participant "Frontend" as FE
participant "API Programmation" as API
database "DB" as DB

Programmeur -> FE: Soumettre programmation
activate FE
FE -> API: POST/PUT /programmations
activate API
API -> DB: V√©rifier conflits (salle/enseignant/sp√©cialit√©)
activate DB
DB --> API: Conflit ? oui/non
deactivate DB

alt Pas de conflit
  API -> DB: Enregistrer programmation
  activate DB
  DB --> API: OK
  deactivate DB
  API --> FE: 200 OK
  FE --> Programmeur: Confirmation
else Conflit d√©tect√©
  API --> FE: 409 Conflict
  FE --> Programmeur: Message d'erreur
end

deactivate API
deactivate FE
@enduml

+------------------use case------------------+
@startuml
left to right direction
actor "Administrateur" as Admin
actor "Programmeur" as Prog
actor "Enseignant" as Teach

rectangle "GeTime2" {
  (S'authentifier) as UC_auth

  (G√©rer utilisateurs) as UC_users
  (Attribuer r√¥les) as UC_roles
  (G√©rer campus) as UC_campus
  (G√©rer √©tablissements) as UC_etab
  (G√©rer √©coles) as UC_school
  (G√©rer secteurs) as UC_sector
  (G√©rer niveaux) as UC_level
  (G√©rer sp√©cialit√©s) as UC_spec
  (G√©rer mati√®res) as UC_subject
  (G√©rer enseignants) as UC_teacher
  (G√©rer salles) as UC_room
  (G√©rer ann√©es) as UC_year
  (G√©rer programmeurs) as UC_programmer
  (G√©rer programmations) as UC_programmation
  (Consulter emploi du temps) as UC_timetable

  (Consulter campus) as UC_view_campus
  (Consulter √©tablissements) as UC_view_etab
  (Consulter √©coles) as UC_view_school
  (Consulter secteurs) as UC_view_sector
  (Consulter niveaux) as UC_view_level
  (Consulter sp√©cialit√©s) as UC_view_spec
  (Consulter mati√®res) as UC_view_subject
  (Consulter enseignants) as UC_view_teacher
  (Consulter salles) as UC_view_room
  (Consulter ann√©es) as UC_view_year

  (G√©rer disponibilit√©s personnelles) as UC_dispo_self
  (Consulter disponibilit√©s) as UC_view_dispo
}

Admin --> UC_users
Admin --> UC_roles
Admin --> UC_campus
Admin --> UC_etab
Admin --> UC_school
Admin --> UC_sector
Admin --> UC_level
Admin --> UC_spec
Admin --> UC_subject
Admin --> UC_teacher
Admin --> UC_room
Admin --> UC_year
Admin --> UC_programmer
Admin --> UC_programmation
Admin --> UC_timetable

Prog --> UC_view_campus
Prog --> UC_view_etab
Prog --> UC_view_school
Prog --> UC_view_sector
Prog --> UC_view_level
Prog --> UC_view_spec
Prog --> UC_view_subject
Prog --> UC_view_teacher
Prog --> UC_view_room
Prog --> UC_view_year
Prog --> UC_programmation
Prog --> UC_timetable

Teach --> UC_view_campus
Teach --> UC_view_etab
Teach --> UC_view_school
Teach --> UC_view_sector
Teach --> UC_view_level
Teach --> UC_view_spec
Teach --> UC_view_subject
Teach --> UC_view_teacher
Teach --> UC_view_room
Teach --> UC_view_year
Teach --> UC_dispo_self
Teach --> UC_view_dispo
Teach --> UC_timetable

' Auth obligatoire pour toutes les actions
UC_users ..> UC_auth : <<include>>
UC_roles ..> UC_auth : <<include>>
UC_campus ..> UC_auth : <<include>>
UC_etab ..> UC_auth : <<include>>
UC_school ..> UC_auth : <<include>>
UC_sector ..> UC_auth : <<include>>
UC_level ..> UC_auth : <<include>>
UC_spec ..> UC_auth : <<include>>
UC_subject ..> UC_auth : <<include>>
UC_teacher ..> UC_auth : <<include>>
UC_room ..> UC_auth : <<include>>
UC_year ..> UC_auth : <<include>>
UC_programmer ..> UC_auth : <<include>>
UC_programmation ..> UC_auth : <<include>>
UC_timetable ..> UC_auth : <<include>>

UC_view_campus ..> UC_auth : <<include>>
UC_view_etab ..> UC_auth : <<include>>
UC_view_school ..> UC_auth : <<include>>
UC_view_sector ..> UC_auth : <<include>>
UC_view_level ..> UC_auth : <<include>>
UC_view_spec ..> UC_auth : <<include>>
UC_view_subject ..> UC_auth : <<include>>
UC_view_teacher ..> UC_auth : <<include>>
UC_view_room ..> UC_auth : <<include>>
UC_view_year ..> UC_auth : <<include>>
UC_dispo_self ..> UC_auth : <<include>>
UC_view_dispo ..> UC_auth : <<include>>

@enduml




A) BACKEND (Laravel 12)
0) Pr√©-requis (FCM c√¥t√© Laravel)

Tu as 2 choix :

Recommand√© : utiliser le SDK Firebase (Kreait) ‚Üí fiable, simple.

Sinon : appeler FCM HTTP v1 ‚Äú√† la main‚Äù (plus long).

Ici je pars sur Kreait.

Fichier √† MODIFIER : .env

Ajoute :

FCM_ENABLED=true
FIREBASE_CREDENTIALS=/absolute/path/storage/app/firebase/service-account.json
FCM_DEFAULT_TTL=3600


FIREBASE_CREDENTIALS pointe vers ton fichier JSON ‚Äúservice account‚Äù Firebase.

1) Device tokens (pour stocker les tokens push des users)
1.1 Fichier √† CR√âER : database/migrations/2026_01_17_000001_create_device_tokens_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration {
    public function up(): void
    {
        Schema::create('device_tokens', function (Blueprint $table) {
            $table->id();
            $table->foreignId('user_id')->constrained()->cascadeOnDelete();

            $table->string('token', 512)->unique();
            $table->string('platform')->default('web'); // web|android|ios
            $table->timestamp('last_seen_at')->nullable();

            $table->timestamps();

            $table->index(['user_id', 'platform']);
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('device_tokens');
    }
};

1.2 Fichier √† CR√âER : app/Models/DeviceToken.php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;

class DeviceToken extends Model
{
    protected $fillable = [
        'user_id', 'token', 'platform', 'last_seen_at',
    ];

    protected $casts = [
        'last_seen_at' => 'datetime',
    ];

    public function user(): BelongsTo
    {
        return $this->belongsTo(User::class);
    }
}

1.3 Fichier √† MODIFIER : app/Models/User.php

Ajoute la relation :

use App\Models\DeviceToken;
use Illuminate\Database\Eloquent\Relations\HasMany;

public function deviceTokens(): HasMany
{
    return $this->hasMany(DeviceToken::class);
}

2) API pour enregistrer le token FCM (appel√© par React)
2.1 Fichier √† CR√âER : app/Http/Controllers/Api/DeviceTokenController.php
<?php

namespace App\Http\Controllers\Api;

use App\Http\Controllers\Controller;
use App\Models\DeviceToken;
use Illuminate\Http\Request;

class DeviceTokenController extends Controller
{
    public function store(Request $request)
    {
        $data = $request->validate([
            'token' => ['required', 'string', 'max:512'],
            'platform' => ['nullable', 'string', 'in:web,android,ios'],
        ]);

        $user = $request->user();

        DeviceToken::updateOrCreate(
            ['token' => $data['token']],
            [
                'user_id' => $user->id,
                'platform' => $data['platform'] ?? 'web',
                'last_seen_at' => now(),
            ]
        );

        return response()->json(['message' => 'Device token saved.']);
    }

    public function destroy(Request $request)
    {
        $data = $request->validate([
            'token' => ['required', 'string', 'max:512'],
        ]);

        DeviceToken::where('token', $data['token'])
            ->where('user_id', $request->user()->id)
            ->delete();

        return response()->json(['message' => 'Device token removed.']);
    }
}

2.2 Fichier √† MODIFIER : routes/api.php

Ajoute :

use App\Http\Controllers\Api\DeviceTokenController;

Route::middleware('auth:sanctum')->group(function () {
    Route::post('/device-tokens', [DeviceTokenController::class, 'store']);
    Route::delete('/device-tokens', [DeviceTokenController::class, 'destroy']);
});

3) Push Channel (FCM) + Service
3.1 Fichier √† CR√âER : app/Services/FcmService.php
<?php

namespace App\Services;

use Illuminate\Support\Collection;
use Kreait\Firebase\Contract\Messaging;
use Kreait\Firebase\Messaging\CloudMessage;

class FcmService
{
    public function __construct(private Messaging $messaging) {}

    /**
     * @param array<int,string> $tokens
     * @param array<string,mixed> $data
     */
    public function sendToTokens(array $tokens, string $title, string $body, array $data = []): void
    {
        if (!(bool) config('services.fcm.enabled')) {
            return;
        }

        $tokens = array_values(array_unique(array_filter($tokens)));
        if (count($tokens) === 0) {
            return;
        }

        // FCM data must be string values
        $data = collect($data)->map(fn($v) => is_scalar($v) ? (string) $v : json_encode($v))->all();

        $message = CloudMessage::new()
            ->withNotification(['title' => $title, 'body' => $body])
            ->withData($data);

        // multicast
        $this->messaging->sendMulticast($message, $tokens);
    }
}

3.2 Fichier √† MODIFIER : config/services.php

Ajoute :

'fcm' => [
    'enabled' => env('FCM_ENABLED', false),
],

3.3 Fichier √† CR√âER : app/Notifications/Channels/FcmChannel.php
<?php

namespace App\Notifications\Channels;

use App\Services\FcmService;
use Illuminate\Notifications\Notification;

class FcmChannel
{
    public function __construct(private FcmService $fcm) {}

    public function send($notifiable, Notification $notification): void
    {
        if (!method_exists($notification, 'toFcm')) {
            return;
        }

        $payload = $notification->toFcm($notifiable);

        $tokens = $notifiable->deviceTokens()->pluck('token')->toArray();

        $this->fcm->sendToTokens(
            $tokens,
            $payload['title'] ?? '',
            $payload['body'] ?? '',
            $payload['data'] ?? []
        );
    }
}

3.4 Service Provider (binding Firebase Messaging)

Fichier √† MODIFIER : app/Providers/AppServiceProvider.php

<?php

namespace App\Providers;

use Illuminate\Support\ServiceProvider;
use Kreait\Firebase\Factory;
use Kreait\Firebase\Contract\Messaging;

class AppServiceProvider extends ServiceProvider
{
    public function register(): void
    {
        $this->app->singleton(Messaging::class, function () {
            $credentials = env('FIREBASE_CREDENTIALS');

            return (new Factory)
                ->withServiceAccount($credentials)
                ->createMessaging();
        });
    }

    public function boot(): void {}
}

4) Notifications (DB + FCM)
4.1 Notification : Disponibilit√© chang√©e ‚Üí programmeur

Fichier √† CR√âER : app/Notifications/TeacherDisponibilityChangedNotification.php

<?php

namespace App\Notifications;

use App\Models\Disponibility;
use App\Notifications\Channels\FcmChannel;
use Illuminate\Bus\Queueable;
use Illuminate\Contracts\Queue\ShouldQueue;
use Illuminate\Notifications\Notification;

class TeacherDisponibilityChangedNotification extends Notification implements ShouldQueue
{
    use Queueable;

    public function __construct(
        public Disponibility $disponibility,
        public string $action // created|updated|deleted
    ) {}

    public function via($notifiable): array
    {
        return ['database', FcmChannel::class];
    }

    public function toDatabase($notifiable): array
    {
        $d = $this->disponibility;

        return [
            'type' => 'teacher_disponibility_changed',
            'action' => $this->action,
            'disponibility_id' => $d->id,
            'subject_id' => $d->subject_id,
            'day' => $d->day,
            'hour_start' => $d->hour_star,
            'hour_end' => $d->hour_end,
        ];
    }

    public function toFcm($notifiable): array
    {
        $d = $this->disponibility;

        $title = "Disponibilit√© enseignant";
        $body = match ($this->action) {
            'created' => "Nouvelle disponibilit√© : {$d->day} {$d->hour_star}-{$d->hour_end}",
            'updated' => "Disponibilit√© modifi√©e : {$d->day} {$d->hour_star}-{$d->hour_end}",
            'deleted' => "Disponibilit√© supprim√©e : {$d->day} {$d->hour_star}-{$d->hour_end}",
            default => "Disponibilit√© mise √† jour",
        };

        return [
            'title' => $title,
            'body' => $body,
            'data' => [
                'type' => 'teacher_disponibility_changed',
                'action' => $this->action,
                'disponibility_id' => $d->id,
                'subject_id' => $d->subject_id,
            ],
        ];
    }
}

4.2 Notification : EDT publi√© ‚Üí enseignants concern√©s

Fichier √† CR√âER : app/Notifications/TimetablePublishedNotification.php

<?php

namespace App\Notifications;

use App\Notifications\Channels\FcmChannel;
use Illuminate\Bus\Queueable;
use Illuminate\Contracts\Queue\ShouldQueue;
use Illuminate\Notifications\Notification;

class TimetablePublishedNotification extends Notification implements ShouldQueue
{
    use Queueable;

    public function __construct(
        public string $weekStart, // YYYY-MM-DD
        public string $weekEnd,   // YYYY-MM-DD
        public int $yearId
    ) {}

    public function via($notifiable): array
    {
        return ['database', FcmChannel::class];
    }

    public function toDatabase($notifiable): array
    {
        return [
            'type' => 'timetable_published',
            'week_start' => $this->weekStart,
            'week_end' => $this->weekEnd,
            'year_id' => $this->yearId,
        ];
    }

    public function toFcm($notifiable): array
    {
        return [
            'title' => "Emploi du temps publi√©",
            'body' => "Votre emploi du temps ({$this->weekStart} ‚Üí {$this->weekEnd}) est disponible.",
            'data' => [
                'type' => 'timetable_published',
                'week_start' => $this->weekStart,
                'week_end' => $this->weekEnd,
                'year_id' => (string) $this->yearId,
            ],
        ];
    }
}

5) Events + Listeners
5.1 Events Disponibility

Fichiers √† CR√âER :

app/Events/DisponibilityCreated.php

app/Events/DisponibilityUpdated.php

app/Events/DisponibilityDeleted.php

Exemple (copie-colle et change juste le nom de la classe) :

<?php

namespace App\Events;

use App\Models\Disponibility;
use Illuminate\Foundation\Events\Dispatchable;
use Illuminate\Queue\SerializesModels;

class DisponibilityCreated
{
    use Dispatchable, SerializesModels;

    public function __construct(public Disponibility $disponibility) {}
}


Fais pareil pour Updated / Deleted.

5.2 Listener ‚Üí notifier le programmeur via subject->specialty->programmer_id

Fichier √† CR√âER : app/Listeners/NotifyProgrammerOfDisponibilityChange.php

<?php

namespace App\Listeners;

use App\Events\DisponibilityCreated;
use App\Events\DisponibilityUpdated;
use App\Events\DisponibilityDeleted;
use App\Models\Subject;
use App\Models\User;
use App\Notifications\TeacherDisponibilityChangedNotification;

class NotifyProgrammerOfDisponibilityChange
{
    public function handle($event): void
    {
        $d = $event->disponibility;

        // subject -> specialty -> programmer_id
        $subject = Subject::with('specialty.programmer.user')->find($d->subject_id);
        if (!$subject || !$subject->specialty || !$subject->specialty->programmer) {
            return;
        }

        // programmer is a model, we need the programmer's USER to notify (because tokens are on users)
        $programmerUser = $subject->specialty->programmer->user;
        if (!$programmerUser instanceof User) {
            return;
        }

        $action = match (true) {
            $event instanceof DisponibilityCreated => 'created',
            $event instanceof DisponibilityUpdated => 'updated',
            $event instanceof DisponibilityDeleted => 'deleted',
            default => 'updated',
        };

        $programmerUser->notify(new TeacherDisponibilityChangedNotification($d, $action));
    }
}


‚ö†Ô∏è Ce code suppose ces relations existent :

Subject belongsTo Specialty

Specialty belongsTo Programmer

Programmer belongsTo User

Si tes noms diff√®rent, tu adaptes juste les relations.

5.3 Event ‚Äúpublier emploi du temps‚Äù

Fichier √† CR√âER : app/Events/TimetablePublished.php

<?php

namespace App\Events;

use Illuminate\Foundation\Events\Dispatchable;
use Illuminate\Queue\SerializesModels;

class TimetablePublished
{
    use Dispatchable, SerializesModels;

    public function __construct(
        public string $weekStart,
        public string $weekEnd,
        public int $yearId,
        public int $programmerId
    ) {}
}

5.4 Listener : notifier tous les enseignants concern√©s

Fichier √† CR√âER : app/Listeners/NotifyTeachersOfPublishedTimetable.php

<?php

namespace App\Listeners;

use App\Events\TimetablePublished;
use App\Models\Programmation;
use App\Models\Subject;
use App\Models\User;
use App\Notifications\TimetablePublishedNotification;

class NotifyTeachersOfPublishedTimetable
{
    public function handle(TimetablePublished $event): void
    {
        // 1) s√©ances publi√©es de la semaine
        $programmations = Programmation::query()
            ->where('year_id', $event->yearId)
            ->where('status', 'published')
            ->whereBetween('day', [$event->weekStart, $event->weekEnd]) // si day est DATE
            ->get(['id', 'subject_id']);

        if ($programmations->isEmpty()) return;

        $subjectIds = $programmations->pluck('subject_id')->unique()->values();

        // 2) subjects -> teacher_id -> teacher.user_id
        $subjects = Subject::with('teacher.user')
            ->whereIn('id', $subjectIds)
            ->get();

        $teacherUsers = $subjects
            ->map(fn($s) => $s->teacher?->user)
            ->filter(fn($u) => $u instanceof User)
            ->unique('id')
            ->values();

        foreach ($teacherUsers as $user) {
            $user->notify(new TimetablePublishedNotification(
                $event->weekStart,
                $event->weekEnd,
                $event->yearId
            ));
        }
    }
}


‚ö†Ô∏è Ici je suppose que Programmation.day est une DATE.
Si day est un texte (‚ÄúMonday‚Äù), alors il faut stocker la date ou ajouter un champ date/week_id. Mais comme tu veux ‚Äúsemaine‚Äù, le mieux est day=DATE.

6) Enregistrer les listeners

Fichier √† MODIFIER : app/Providers/EventServiceProvider.php

<?php

namespace App\Providers;

use Illuminate\Foundation\Support\Providers\EventServiceProvider as ServiceProvider;

use App\Events\DisponibilityCreated;
use App\Events\DisponibilityUpdated;
use App\Events\DisponibilityDeleted;
use App\Events\TimetablePublished;

use App\Listeners\NotifyProgrammerOfDisponibilityChange;
use App\Listeners\NotifyTeachersOfPublishedTimetable;

class EventServiceProvider extends ServiceProvider
{
    protected $listen = [
        DisponibilityCreated::class => [
            NotifyProgrammerOfDisponibilityChange::class,
        ],
        DisponibilityUpdated::class => [
            NotifyProgrammerOfDisponibilityChange::class,
        ],
        DisponibilityDeleted::class => [
            NotifyProgrammerOfDisponibilityChange::class,
        ],
        TimetablePublished::class => [
            NotifyTeachersOfPublishedTimetable::class,
        ],
    ];
}

7) Dispatch automatique des events quand Disponibility change

Le plus simple : dans le mod√®le Disponibility.

Fichier √† MODIFIER : app/Models/Disponibility.php

<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use App\Events\DisponibilityCreated;
use App\Events\DisponibilityUpdated;
use App\Events\DisponibilityDeleted;

class Disponibility extends Model
{
    protected static function booted(): void
    {
        static::created(fn($d) => event(new DisponibilityCreated($d)));
        static::updated(fn($d) => event(new DisponibilityUpdated($d)));
        static::deleted(fn($d) => event(new DisponibilityDeleted($d)));
    }
}

8) Endpoint ‚Äúpublier emploi du temps semaine‚Äù
8.1 Fichier √† CR√âER : app/Http/Controllers/Api/ProgrammationPublishController.php
<?php

namespace App\Http\Controllers\Api;

use App\Events\TimetablePublished;
use App\Http\Controllers\Controller;
use App\Models\Programmation;
use Illuminate\Http\Request;

class ProgrammationPublishController extends Controller
{
    public function publishWeek(Request $request)
    {
        $data = $request->validate([
            'year_id' => ['required', 'integer'],
            'week_start' => ['required', 'date'], // YYYY-MM-DD
            'week_end' => ['required', 'date', 'after_or_equal:week_start'],
        ]);

        // Ici tu peux v√©rifier que l'utilisateur connect√© est un programmer, etc.

        Programmation::query()
            ->where('year_id', $data['year_id'])
            ->whereBetween('day', [$data['week_start'], $data['week_end']])
            ->update(['status' => 'published']);

        event(new TimetablePublished(
            $data['week_start'],
            $data['week_end'],
            (int) $data['year_id'],
            (int) ($request->user()->id) // ou programmer_id si tu l'as
        ));

        return response()->json([
            'message' => 'Timetable published and notifications sent.',
        ]);
    }
}

8.2 Fichier √† MODIFIER : routes/api.php

Ajoute :

use App\Http\Controllers\Api\ProgrammationPublishController;

Route::middleware('auth:sanctum')->group(function () {
    Route::post('/programmations/publish-week', [ProgrammationPublishController::class, 'publishWeek']);
});

9) Queue (obligatoire en prod)

Tes notifications impl√©mentent ShouldQueue, donc configure queue + worker.

Tu as d√©j√† tables jobs etc.
Assure-toi que .env contient :

QUEUE_CONNECTION=database


Et que ton worker tourne (systemd/supervisor) en prod.

B) FRONTEND (React 19 + Vite)
1) Installer Firebase c√¥t√© React

Tu vas avoir 3 fichiers importants :

1.1 Fichier √† CR√âER : src/firebase/firebase.js
import { initializeApp } from "firebase/app";
import { getMessaging } from "firebase/messaging";

const firebaseConfig = {
  apiKey: import.meta.env.VITE_FIREBASE_API_KEY,
  authDomain: import.meta.env.VITE_FIREBASE_AUTH_DOMAIN,
  projectId: import.meta.env.VITE_FIREBASE_PROJECT_ID,
  storageBucket: import.meta.env.VITE_FIREBASE_STORAGE_BUCKET,
  messagingSenderId: import.meta.env.VITE_FIREBASE_MESSAGING_SENDER_ID,
  appId: import.meta.env.VITE_FIREBASE_APP_ID,
};

const app = initializeApp(firebaseConfig);
export const messaging = getMessaging(app);

1.2 Fichier √† CR√âER : src/firebase/push.js
import { getToken, onMessage } from "firebase/messaging";
import { messaging } from "./firebase";
import api from "../services/api"; // ton axios instance

export async function registerPushToken() {
  if (!("Notification" in window)) return;

  const permission = await Notification.requestPermission();
  if (permission !== "granted") return;

  const vapidKey = import.meta.env.VITE_FIREBASE_VAPID_KEY;

  const token = await getToken(messaging, { vapidKey });
  if (!token) return;

  // Envoi au backend
  await api.post("/device-tokens", { token, platform: "web" });

  // Listener quand l‚Äôapp est ouverte
  onMessage(messaging, (payload) => {
    // Option: afficher toast
    console.log("FCM foreground message:", payload);
  });
}

1.3 Fichier √† CR√âER : public/firebase-messaging-sw.js

(important pour recevoir en background)

/* eslint-disable no-undef */
importScripts("https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js");
importScripts("https://www.gstatic.com/firebasejs/10.12.2/firebase-messaging-compat.js");

firebase.initializeApp({
  apiKey: self.VITE_FIREBASE_API_KEY,
  authDomain: self.VITE_FIREBASE_AUTH_DOMAIN,
  projectId: self.VITE_FIREBASE_PROJECT_ID,
  storageBucket: self.VITE_FIREBASE_STORAGE_BUCKET,
  messagingSenderId: self.VITE_FIREBASE_MESSAGING_SENDER_ID,
  appId: self.VITE_FIREBASE_APP_ID,
});

const messaging = firebase.messaging();

messaging.onBackgroundMessage((payload) => {
  const title = payload?.notification?.title || "Notification";
  const options = {
    body: payload?.notification?.body || "",
    data: payload?.data || {},
  };

  self.registration.showNotification(title, options);
});


Note : pour que le SW ait acc√®s aux variables, tu peux aussi hardcoder la config Firebase dans ce fichier (le plus simple). Vite n‚Äôinjecte pas automatiquement import.meta.env dans public/.

2) Fichier √† MODIFIER : .env (frontend)

Ajoute :

VITE_FIREBASE_API_KEY=...
VITE_FIREBASE_AUTH_DOMAIN=...
VITE_FIREBASE_PROJECT_ID=...
VITE_FIREBASE_STORAGE_BUCKET=...
VITE_FIREBASE_MESSAGING_SENDER_ID=...
VITE_FIREBASE_APP_ID=...
VITE_FIREBASE_VAPID_KEY=...

3) Appeler l‚Äôenregistrement du token apr√®s login

D√®s que l‚Äôutilisateur est connect√© (token Sanctum enregistr√©), appelle registerPushToken().

Exemple : dans ton √©cran login success ou App.jsx.

Fichier √† MODIFIER (exemple) : src/pages/Login.jsx

Apr√®s login r√©ussi :

import { registerPushToken } from "../firebase/push";

...

const onLoginSuccess = async () => {
  // token auth d√©j√† stock√©
  await registerPushToken();
};

C) R√©sultat final (ce que tu veux)

‚úÖ Quand un enseignant cr√©e/modifie/supprime une disponibilit√©
‚Üí event d√©clench√© automatiquement
‚Üí on calcule le programmeur via subject->specialty->programmer_id
‚Üí notification DB + Push envoy√©e au programmeur.

‚úÖ Quand l‚Äôemploi du temps est publi√© pour une semaine
‚Üí endpoint POST /programmations/publish-week
‚Üí statut = published
‚Üí on r√©cup√®re tous les enseignants concern√©s
‚Üí notification DB + Push envoy√©e √† chacun.

Si tu veux, je peux te donner aussi :

le code des relations Eloquent exactes (Subject/Specialty/Programmer/Teacher)

un endpoint /notifications pour afficher la cloche c√¥t√© React

une version ‚Äúmulti-√©tablissements‚Äù (si un programmeur g√®re plusieurs specialties)

donne maintenant l'aborescence des du backend et frontent en tenant compte du faite que les push nofications sont integrer

Voici une arborescence claire (backend + frontend) avec les push notifications int√©gr√©es (FCM + DB notifications), en gardant le style Laravel 12 + React/Vite.

1) Backend (Laravel 12) ‚Äî Arborescence
backend/
‚îú‚îÄ app/
‚îÇ  ‚îú‚îÄ Events/
‚îÇ  ‚îÇ  ‚îú‚îÄ DisponibilityCreated.php
‚îÇ  ‚îÇ  ‚îú‚îÄ DisponibilityUpdated.php
‚îÇ  ‚îÇ  ‚îú‚îÄ DisponibilityDeleted.php
‚îÇ  ‚îÇ  ‚îî‚îÄ TimetablePublished.php
‚îÇ  ‚îÇ
‚îÇ  ‚îú‚îÄ Http/
‚îÇ  ‚îÇ  ‚îî‚îÄ Controllers/
‚îÇ  ‚îÇ     ‚îî‚îÄ Api/
‚îÇ  ‚îÇ        ‚îú‚îÄ DeviceTokenController.php
‚îÇ  ‚îÇ        ‚îî‚îÄ ProgrammationPublishController.php
‚îÇ  ‚îÇ
‚îÇ  ‚îú‚îÄ Listeners/
‚îÇ  ‚îÇ  ‚îú‚îÄ NotifyProgrammerOfDisponibilityChange.php
‚îÇ  ‚îÇ  ‚îî‚îÄ NotifyTeachersOfPublishedTimetable.php
‚îÇ  ‚îÇ
‚îÇ  ‚îú‚îÄ Models/
‚îÇ  ‚îÇ  ‚îú‚îÄ DeviceToken.php
‚îÇ  ‚îÇ  ‚îú‚îÄ Disponibility.php              (modifi√©: dispatch events)
‚îÇ  ‚îÇ  ‚îú‚îÄ Programmation.php
‚îÇ  ‚îÇ  ‚îú‚îÄ Subject.php
‚îÇ  ‚îÇ  ‚îú‚îÄ Specialty.php
‚îÇ  ‚îÇ  ‚îú‚îÄ Programmer.php
‚îÇ  ‚îÇ  ‚îú‚îÄ Teacher.php
‚îÇ  ‚îÇ  ‚îî‚îÄ User.php                       (modifi√©: relation deviceTokens)
‚îÇ  ‚îÇ
‚îÇ  ‚îú‚îÄ Notifications/
‚îÇ  ‚îÇ  ‚îú‚îÄ Channels/
‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ FcmChannel.php
‚îÇ  ‚îÇ  ‚îú‚îÄ TeacherDisponibilityChangedNotification.php
‚îÇ  ‚îÇ  ‚îî‚îÄ TimetablePublishedNotification.php
‚îÇ  ‚îÇ
‚îÇ  ‚îú‚îÄ Providers/
‚îÇ  ‚îÇ  ‚îú‚îÄ AppServiceProvider.php         (modifi√©: Firebase Messaging binding)
‚îÇ  ‚îÇ  ‚îî‚îÄ EventServiceProvider.php       (modifi√©: listeners register)
‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ Services/
‚îÇ     ‚îî‚îÄ FcmService.php
‚îÇ
‚îú‚îÄ config/
‚îÇ  ‚îî‚îÄ services.php                      (modifi√©: fcm enabled)
‚îÇ
‚îú‚îÄ database/
‚îÇ  ‚îî‚îÄ migrations/
‚îÇ     ‚îú‚îÄ 2026_01_17_000001_create_device_tokens_table.php
‚îÇ     ‚îî‚îÄ ... (autres migrations d√©j√† existantes)
‚îÇ
‚îú‚îÄ routes/
‚îÇ  ‚îî‚îÄ api.php                           (modifi√©: routes device-tokens + publish)
‚îÇ
‚îú‚îÄ storage/
‚îÇ  ‚îî‚îÄ app/
‚îÇ     ‚îî‚îÄ firebase/
‚îÇ        ‚îî‚îÄ service-account.json        (cl√© Firebase, √† ne pas commiter)
‚îÇ
‚îú‚îÄ .env                                 (modifi√©: FCM_ENABLED + FIREBASE_CREDENTIALS)
‚îî‚îÄ ...


‚úÖ Ce que √ßa ajoute au backend

Un stockage des tokens (device_tokens)

Un canal de notif FcmChannel

Un service FcmService

Des events/listeners pour envoyer les notifs automatiquement

Un endpoint ‚Äúpublish week‚Äù pour publier et notifier

2) Frontend (React 19 + Vite) ‚Äî Arborescence
frontend/
‚îú‚îÄ public/
‚îÇ  ‚îî‚îÄ firebase-messaging-sw.js          (service worker push)
‚îÇ
‚îú‚îÄ src/
‚îÇ  ‚îú‚îÄ firebase/
‚îÇ  ‚îÇ  ‚îú‚îÄ firebase.js                    (init Firebase + messaging)
‚îÇ  ‚îÇ  ‚îî‚îÄ push.js                        (register token + foreground listener)
‚îÇ  ‚îÇ
‚îÇ  ‚îú‚îÄ services/
‚îÇ  ‚îÇ  ‚îú‚îÄ api.js                         (Axios instance + token)
‚îÇ  ‚îÇ  ‚îî‚îÄ authService.js                 (login/logout si tu as)
‚îÇ  ‚îÇ
‚îÇ  ‚îú‚îÄ pages/
‚îÇ  ‚îÇ  ‚îú‚îÄ Login.jsx                      (modifi√©: registerPushToken apr√®s login)
‚îÇ  ‚îÇ  ‚îú‚îÄ Campuses/
‚îÇ  ‚îÇ  ‚îî‚îÄ Teachers/
‚îÇ  ‚îÇ
‚îÇ  ‚îú‚îÄ components/
‚îÇ  ‚îÇ  ‚îú‚îÄ Navbar.jsx
‚îÇ  ‚îÇ  ‚îî‚îÄ ... (tables/forms)
‚îÇ  ‚îÇ
‚îÇ  ‚îú‚îÄ routes/
‚îÇ  ‚îÇ  ‚îî‚îÄ index.jsx
‚îÇ  ‚îÇ
‚îÇ  ‚îú‚îÄ App.jsx                           (optionnel: hook global push)
‚îÇ  ‚îî‚îÄ main.jsx
‚îÇ
‚îú‚îÄ .env                                 (modifi√©: VITE_FIREBASE_* + VAPID key)
‚îú‚îÄ vite.config.js
‚îî‚îÄ ...


‚úÖ Ce que √ßa ajoute au frontend

Firebase init

R√©cup√©ration du token FCM

Envoi du token au backend (/device-tokens)

R√©ception en foreground + background (SW)

3) Vue globale du flux (simplifi√©)
Teacher -> POST /disponibilities
          -> (Model event) DisponibilityCreated
          -> Listener NotifyProgrammerOfDisponibilityChange
          -> Programmer(User) receives:
              - DB notification
              - FCM push

Programmer -> POST /programmations/publish-week
            -> status = published
            -> Event TimetablePublished
            -> Listener NotifyTeachersOfPublishedTimetable
            -> Teachers(User) receive:
                - DB notification
                - FCM push


Si tu veux, je peux aussi te donner une arborescence ‚Äúclean architecture‚Äù (avec Domain/, Application/, Infrastructure/) plus ‚Äúpro‚Äù, mais celle-ci reste parfaite et standard pour Laravel/React.